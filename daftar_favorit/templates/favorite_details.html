{% extends 'base.html' %}

{% block meta %}
    <title>Favorites</title>
{% endblock meta %}

{% block content %}

    <style>
        .favorites-link {
            color: white !important; /* Use !important to override any other styles */
        }
    </style>

    <div>
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                padding: 8px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            h1 {
                text-align: center;
            }
            .icon-add {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999; 
                font-size: 70px;
                color: green;
                
                margin-right: 2%;
                margin-bottom: 2%;
            }
            .delete-button {
                background: none;
                border: none;
                color: red;
                font-size: 30px;
                cursor: pointer;
            }
            .delete-button:hover {
                color: rgb(69, 0, 0);
            }
        </style>
        
        <div class = "container justify-content-center align-items-center my-5">

            <div class="pt-3 pb-5">
                <h1>Favorites</h1>
            </div>

            <div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Judul</th>
                            <th>Waktu</th>
                            <th></th>
                        </tr>
                    </thead>   
                    {% for favorite in favorites %}
                    <tbody>
                        <tr>
                            <td>
                                <h4>{{ favorite.0 }}</h4>
                            </td>

                            <td>{{ favorite.1 }}</td>

                            <td>
                                <button class="delete-button" onclick="deleteFavorite('{{ forloop.counter }}')" style="color: red; font-size: 30px;">
                                    <ion-icon name="close-circle"></ion-icon>
                                </button>                               
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>

        </div>

        <a href="add">
            <ion-icon name="add-circle" class="icon-add"> </ion-icon>
        </a>

    </div>

    <script>
        async function deleteFavorite(rowId) {
            try {
                var row = document.getElementById(rowId);
                row.parentNode.removeChild(row);
                
                if (!row) {
                    console.error('Row not found:', rowId);
                    return;
                }

                const judulElement = row.querySelector('h4');

                if (!judulElement) {
                    console.error('Judul element not found in row:', rowId);
                    return;
                }

                const judul = judulElement.textContent;

                const response = await fetch('/favorites/delete/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'  // Include CSRF token for security
                    },
                    body: JSON.stringify({ 'judul': judul })
                });

                if (response.ok) {
                    row.remove();
                } else {
                    console.error('Failed to delete the favorite');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>

{% endblock content %}