{% extends 'base.html' %}

{% block meta %}
    <title>Favorites</title>
{% endblock meta %}

{% block content %}

    <style>
        .downloads-link {
            color: white !important; /* Use !important to override any other styles */
        }
    </style>

    <div>
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                padding: 8px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            h1 {
                text-align: center;
            }
            .icon-add {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999; 
                font-size: 70px;
                color: green;
                
                margin-right: 2%;
                margin-bottom: 2%;
            }
            .delete-button {
                background: none;
                border: none;
                color: red;
                font-size: 30px;
                cursor: pointer;
            }
            .delete-button:hover {
                color: rgb(69, 0, 0);
            }
        </style>
        
        <div class = "container justify-content-center align-items-center my-5">

            <div class="pt-3 pb-5">
                <h1>Downloads</h1>
            </div>

            <div>
                <table class="table table-striped">
                    
                    <thead>
                        <tr>
                            <th>Judul</th>
                            <th>Waktu</th>
                            <th></th>
                        </tr>
                    </thead>   
                    {% for download in daftar_unduhan %} 
                    <tbody>
                        <tr>
                            <td>
                                <h4>{{ download.0 }}</h4>
                            </td>

                            <td>{{ download.1 }}</td>
                            <td>
                                <button type="button" data-title="{{ download.0.judul }}" data-timestamp="{{ download.1 }}">
                                    <ion-icon name="close-circle"></ion-icon>
                                </button>                               
                            </td>
                        </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

    <script>
        $('.delete-button').click(function() {
              var judul = $(this).data('title');
              var timestamp = $(this).data('timestamp');
              var button = $(this);
              var deleteUrl = $('#delete-url').val();
              var csrfToken = $('#csrf-token').val();
      
              $.ajax({
                  url: deleteUrl,
                  type: 'POST',
                  data: {
                      'judul': judul,
                      'timestamp': timestamp,
                      'csrfmiddlewaretoken': csrfToken
                  },
                  dataType: 'json',
                  success: function(data) {
                      if (data.success) {
                          alert('Item deleted successfully');
                          button.closest('tr').remove();
                      } else {
                          alert('Error: ' + data.error);
                      }
                  },
                  error: function(xhr, status, error) {
                      alert('Error: ' + error);
                  }
              });
          });
      </script>
{% endblock content %}